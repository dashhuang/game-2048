# 2048游戏

一个优雅精致的2048游戏实现，支持桌面和移动设备，具有流畅的动画效果和直观的操作体验。

## 功能特性

### 核心功能
- **经典2048游戏玩法**：通过滑动合并相同数字，目标是创建2048方块
- **分数系统**：实时显示当前分数和历史最高分
- **增强撤销系统**：
  - 支持多步撤销（初始3次）
  - 每合成256的倍数获得额外撤销次数
  - 最多累计10次撤销
  - 撤销按钮显示剩余次数
- **游戏状态**：自动检测游戏胜利或失败状态

### 操作支持
- **键盘控制**（桌面端）：使用方向键进行操作
- **触摸手势**（移动端）：支持上下左右滑动手势
- **鼠标拖拽**：桌面端也可使用鼠标拖拽操作

### 界面设计
- **响应式布局**：自适应不同屏幕尺寸
- **液态玻璃效果**（iOS 26风格）：
  - 半透明毛玻璃质感，高饱和度视觉效果
  - SVG滤镜创造真实的液体扭曲效果
  - feTurbulence生成柏林噪声纹理
  - feDisplacementMap实现背景扭曲变形
  - 动态参数控制，创造持续流动的液体效果
  - 合并时触发液态爆发动画
- **优雅动画**：
  - 新方块出现动画（缩放淡入效果）
  - 方块合并动画（弹跳效果 + 液态爆发）
  - **流畅的移动动画**：方块从原位置平滑滑动到目标位置
  - 动画时序精确控制，确保视觉连贯性
- **配色方案**：采用经典2048配色，不同数字有独特的颜色标识

## 技术实现

### 文件结构
```
2048/
├── index.html      # 游戏主页面
├── style.css       # 样式文件
├── script.js       # 游戏逻辑
└── README.md      # 项目说明
```

### 技术栈
- **HTML5**：语义化标签，移动端视口优化，SVG滤镜
- **CSS3**：
  - CSS Grid布局系统
  - CSS变量动态控制
  - backdrop-filter毛玻璃效果
  - mask-image液态边缘
  - 高级动画与过渡效果
- **原生JavaScript**：ES6类语法，事件监听，DOM操作
- **SVG滤镜**：feTurbulence噪声生成，feDisplacementMap位移映射

### 核心算法
1. **移动算法**：
   - 记录每个方块的原始位置和目标位置
   - 识别需要合并的方块对
   - 计算移动路径并生成动画序列

2. **动画系统**：
   - 使用CSS transition实现平滑移动（150ms）
   - 方块移动和合并动画分离处理
   - 保持DOM元素引用，避免重复创建和销毁
   - 精确的时序控制确保动画流畅

3. **游戏状态检测**：
   - 胜利条件：出现2048方块
   - 失败条件：无空格且无可合并方块

4. **手势识别**：
   - 计算滑动距离和方向
   - 设置最小滑动阈值（50px）

## 使用方法

### 本地运行
1. 下载项目文件
2. 在浏览器中打开 `index.html`
3. 开始游戏！

### 游戏操作
- **桌面端**：使用键盘方向键或鼠标拖拽
- **移动端**：在游戏区域内滑动手指
- **新游戏**：点击"新游戏"按钮
- **撤销**：点击"撤销"按钮返回上一步

## 特色功能

### 增强撤销系统配置
游戏中的撤销系统可以通过修改以下变量进行自定义：
```javascript
this.initialUndoCount = 3;      // 初始撤销次数
this.maxUndoCount = 10;         // 最大累计撤销次数
this.undoRewardValue = 256;     // 获得撤销奖励的方块值
```

### 数据持久化
- 使用 localStorage 保存最高分
- 刷新页面后最高分不会丢失

### 性能优化
- 使用 CSS transform 实现动画，避免重排
- 事件委托减少事件监听器数量
- 防止触摸设备的默认滚动行为
- 动画状态管理，防止操作冲突
- 重复状态检查，优化历史栈存储
- 液态玻璃效果优化：
  - 使用will-change提示浏览器优化
  - SVG滤镜硬件加速
  - 智能降级策略，不支持的浏览器自动关闭
  - 减少动画模式支持（prefers-reduced-motion）

### 用户体验
- 清晰的视觉反馈
- 流畅的交互动画
- 直观的操作提示
- 支持撤销操作，降低操作失误成本

## 浏览器兼容性

### 完整液态玻璃效果支持
- Safari 15+（最佳效果）
- Chrome 76+ / Edge 79+
- Firefox 103+（需启用backdrop-filter）

### 降级支持
- 旧版浏览器自动降级为经典纯色方块
- 支持CSS.supports检测，确保游戏正常运行
- prefers-reduced-motion用户可禁用动画效果

## 更新历史

### v1.0 - 初始版本
- **核心玩法**: 实现经典2048游戏逻辑，包括分数系统、游戏状态检测。
- **多平台操作**: 支持桌面端键盘、鼠标拖拽及移动端触摸手势。
- **响应式设计**: 界面自适应不同屏幕尺寸。

### v1.1 - 动画与视觉增强
- **流畅动画**: 优化方块的移动、合并与出现动画，提升视觉连贯性。
- **液态玻璃效果**:
    - 基于SVG滤镜（`feTurbulence` 和 `feDisplacementMap`）实现真实的液态扭曲效果。
    - 动态参数控制，创造持续流动的液体质感。
    - 合并方块时触发"液态爆发"动画。
    - 优化模糊与扭曲参数，实现类似iOS的视觉风格。
- **界面风格统一**:
    - 按钮和分数框均采用液态玻璃效果，实现统一的视觉语言。
    - 移除元素外部阴影，采用内部光泽和透明度塑造层次感。

### v1.2 - 功能增强与体验优化
- **增强撤销系统**:
    - 支持多步撤销（初始3次，最多10次）。
    - 合成256的倍数时，奖励额外撤销次数。
    - 按钮实时显示剩余次数。
    - 撤销操作附带平滑的逆向动画。
- **确定性撤销**: 引入基于种子的伪随机数生成器，确保撤销后操作结果可重现。
- **全屏操作**:
    - 将触摸和鼠标事件监听扩展至全屏范围。
    - 降低滑动触发阈值，提升移动端操作便捷性。

### v1.3 - 布局与兼容性修复
- **布局修复**:
    - 使用CSS Grid重构棋盘格，解决方块对齐问题。
    - 修复因`display: flex`导致的按钮垂直排列问题。
    - 统一界面元素尺寸，使布局更整洁。
- **移动端优化**:
    - 优化响应式布局，确保在iPhone等小屏幕设备上标题、分数框等元素能正确单行显示。
    - 修复页面滚动问题，实现固定视口。
    - 适配iPhone安全区域（刘海屏），实现真正的沉浸式全屏体验。
- **Bug修复**:
    - 修复方块合并时后续方块位置计算错误的逻辑。
    - 解决撤销功能中出现的跳步、无效操作等问题。
    - 修复液态玻璃效果作用范围错误，防止UI元素被扭曲。
