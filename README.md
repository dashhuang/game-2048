# 2048游戏

一个优雅精致的2048游戏实现，支持桌面和移动设备，具有流畅的动画效果和直观的操作体验。

## 功能特性

### 核心功能
- **经典2048游戏玩法**：通过滑动合并相同数字，目标是创建2048方块
- **分数系统**：实时显示当前分数和历史最高分
- **增强撤销系统**：
  - 支持多步撤销（初始3次）
  - 每合成256的倍数获得额外撤销次数
  - 最多累计10次撤销
  - 撤销按钮显示剩余次数
- **游戏状态**：自动检测游戏胜利或失败状态

### 操作支持
- **键盘控制**（桌面端）：使用方向键进行操作
- **触摸手势**（移动端）：支持上下左右滑动手势
- **鼠标拖拽**：桌面端也可使用鼠标拖拽操作

### 界面设计
- **响应式布局**：自适应不同屏幕尺寸
- **液态玻璃效果**（iOS 26风格）：
  - 半透明毛玻璃质感，高饱和度视觉效果
  - 流体形变边缘，如水波般的自然晃动
  - 基于SVG滤镜的液态动画（feTurbulence + feDisplacementMap）
  - 鼠标悬停交互增强，合并时液态爆发效果
- **优雅动画**：
  - 新方块出现动画（缩放淡入效果）
  - 方块合并动画（弹跳效果 + 液态爆发）
  - **流畅的移动动画**：方块从原位置平滑滑动到目标位置
  - 动画时序精确控制，确保视觉连贯性
- **配色方案**：采用经典2048配色，不同数字有独特的颜色标识

## 技术实现

### 文件结构
```
2048/
├── index.html      # 游戏主页面
├── style.css       # 样式文件
├── script.js       # 游戏逻辑
└── README.md      # 项目说明
```

### 技术栈
- **HTML5**：语义化标签，移动端视口优化，SVG滤镜
- **CSS3**：
  - CSS Grid布局系统
  - CSS变量动态控制
  - backdrop-filter毛玻璃效果
  - mask-image液态边缘
  - 高级动画与过渡效果
- **原生JavaScript**：ES6类语法，事件监听，DOM操作
- **SVG滤镜**：feTurbulence噪声生成，feDisplacementMap位移映射

### 核心算法
1. **移动算法**：
   - 记录每个方块的原始位置和目标位置
   - 识别需要合并的方块对
   - 计算移动路径并生成动画序列

2. **动画系统**：
   - 使用CSS transition实现平滑移动（150ms）
   - 方块移动和合并动画分离处理
   - 保持DOM元素引用，避免重复创建和销毁
   - 精确的时序控制确保动画流畅

3. **游戏状态检测**：
   - 胜利条件：出现2048方块
   - 失败条件：无空格且无可合并方块

4. **手势识别**：
   - 计算滑动距离和方向
   - 设置最小滑动阈值（50px）

## 使用方法

### 本地运行
1. 下载项目文件
2. 在浏览器中打开 `index.html`
3. 开始游戏！

### 游戏操作
- **桌面端**：使用键盘方向键或鼠标拖拽
- **移动端**：在游戏区域内滑动手指
- **新游戏**：点击"新游戏"按钮
- **撤销**：点击"撤销"按钮返回上一步

## 特色功能

### 增强撤销系统配置
游戏中的撤销系统可以通过修改以下变量进行自定义：
```javascript
this.initialUndoCount = 3;      // 初始撤销次数
this.maxUndoCount = 10;         // 最大累计撤销次数
this.undoRewardValue = 256;     // 获得撤销奖励的方块值
```

### 数据持久化
- 使用 localStorage 保存最高分
- 刷新页面后最高分不会丢失

### 性能优化
- 使用 CSS transform 实现动画，避免重排
- 事件委托减少事件监听器数量
- 防止触摸设备的默认滚动行为
- 动画状态管理，防止操作冲突
- 重复状态检查，优化历史栈存储
- 液态玻璃效果优化：
  - 使用will-change提示浏览器优化
  - SVG滤镜硬件加速
  - 智能降级策略，不支持的浏览器自动关闭
  - 减少动画模式支持（prefers-reduced-motion）

### 用户体验
- 清晰的视觉反馈
- 流畅的交互动画
- 直观的操作提示
- 支持撤销操作，降低操作失误成本

## 浏览器兼容性

### 完整液态玻璃效果支持
- Safari 15+（最佳效果）
- Chrome 76+ / Edge 79+
- Firefox 103+（需启用backdrop-filter）

### 降级支持
- 旧版浏览器自动降级为经典纯色方块
- 支持CSS.supports检测，确保游戏正常运行
- prefers-reduced-motion用户可禁用动画效果

## 更新日志
- 2024-01 - 初始版本发布
  - 实现核心游戏逻辑
  - 添加键盘和触摸控制
  - 设计响应式界面
  - 实现动画效果
- 2024-01 - 动画优化更新
  - 添加方块移动的平滑过渡动画
  - 优化合并动画的时序
  - 改进整体游戏体验，让玩家能清楚看到方块的移动轨迹
- 2024-01 - 修复移动逻辑bug
  - 修复了当有方块合并时，后续方块位置计算错误的问题
  - 重构processLine函数，使用originalIndex追踪方块原始位置
  - 确保所有方块都能正确移动到目标位置
- 2024-01 - 修复方块对齐问题
  - 将背景格子布局从flexbox改为CSS Grid，确保精确对齐
  - 更新方块位置计算逻辑，使用CSS calc进行精确定位
  - 支持响应式间隙调整，确保在不同屏幕尺寸下都能正确对齐
- 2024-01 - 增强撤销系统
  - 实现多步撤销功能，使用历史状态栈
  - 初始提供3次撤销机会
  - 每合成256的倍数（256、512、768等）奖励1次撤销
  - 最多累计10次撤销，防止过度使用
  - 撤销按钮实时显示剩余次数，无次数时自动禁用
  - 添加获得撤销次数的动画提示
- 2024-01 - 撤销动画优化
  - 添加撤销操作的反向动画效果
  - 方块移动时有平滑的过渡动画
  - 新生成的方块会以缩小消失的动画移除
  - 被合并的方块会以旋转分裂的效果重新出现
  - 让玩家清楚地看到游戏状态如何回退
- 2024-01 - 实现确定性撤销
  - 添加基于种子的伪随机数生成器
  - 使用线性同余生成器（LCG）算法
  - 在状态中保存随机种子和方块ID
  - 撤销后再做相同操作会得到相同结果
  - 确保游戏的可重现性和公平性
- 2024-01 - 修复撤销跳步问题
  - 修正了撤销会跳过一步的bug
  - 现在在移动完成并添加新方块后保存完整状态
  - 调整撤销逻辑，正确恢复到上一个状态
  - 确保每次撤销只回退一步
- 2024-01 - 修复撤销无效问题
  - 修复了点击撤销后次数减少但界面无变化的bug
  - 添加isAnimating标志，防止动画进行中的操作冲突
  - 实现重复状态检查，避免保存相同的游戏状态
  - 改进撤销动画计算逻辑，使用状态快照
  - 确保撤销操作的可靠性和流畅性
- 2024-01 - 添加液态玻璃效果
  - 实现iOS 26风格的液态玻璃视觉效果
  - 使用SVG滤镜（feTurbulence + feDisplacementMap）创建流体形变
  - 添加backdrop-filter实现毛玻璃虚化
  - 支持鼠标悬停交互增强效果
  - 合并时触发液态爆发动画
  - 优化性能，支持降级方案和减少动画模式 